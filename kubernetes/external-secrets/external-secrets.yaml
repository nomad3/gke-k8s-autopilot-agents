# Example ExternalSecret resources to sync secrets from Google Secret Manager to Kubernetes

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: database-credentials
  namespace: backend
spec:
  refreshInterval: 1h  # Sync every hour
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: database-credentials  # Name of Kubernetes Secret to create
    creationPolicy: Owner
  data:
  - secretKey: password  # Key in Kubernetes Secret
    remoteRef:
      key: dev-database-password  # Secret Manager secret ID
  - secretKey: url
    remoteRef:
      key: dev-database-url

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: jwt-secret
  namespace: backend
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: jwt-secret
    creationPolicy: Owner
  data:
  - secretKey: secret
    remoteRef:
      key: dev-jwt-secret

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: api-keys
  namespace: backend
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: api-keys
    creationPolicy: Owner
  data:
  - secretKey: keys
    remoteRef:
      key: dev-api-keys

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: database-password
  namespace: database
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: database-password
    creationPolicy: Owner
  data:
  - secretKey: password
    remoteRef:
      key: dev-database-password
  - secretKey: url
    remoteRef:
      key: dev-database-url

---
# Example: TLS certificate for Ingress
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: tls-certificate
  namespace: default
spec:
  refreshInterval: 24h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: tls-certificate
    creationPolicy: Owner
    template:
      type: kubernetes.io/tls  # Special type for TLS secrets
  data:
  - secretKey: tls.crt
    remoteRef:
      key: dev-tls-cert
  - secretKey: tls.key
    remoteRef:
      key: dev-tls-key
