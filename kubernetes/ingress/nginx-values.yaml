# NGINX Ingress Controller Helm Values
# Deploy using: helm upgrade --install ingress-nginx ingress-nginx/ingress-nginx -n ingress-nginx -f values.yaml

# Controller configuration
controller:
  # Replica count for high availability
  replicaCount: 2
  
  # Resource requests and limits (cost-aware for Autopilot)
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  
  # Service configuration
  service:
    type: LoadBalancer
    annotations:
      # GCP-specific load balancer annotations
      cloud.google.com/load-balancer-type: "External"
      # Optional: Reserve static IP
      # networking.gke.io/load-balancer-ip-addresses: "STATIC_IP_NAME"
    externalTrafficPolicy: Local  # Preserve source IP
  
  # Autoscaling
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  # Metrics for monitoring
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: monitoring
  
  # Pod security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 101
    fsGroup: 101
    seccompProfile:
      type: RuntimeDefault
  
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    runAsUser: 101
    capabilities:
      drop:
      - ALL
      add:
      - NET_BIND_SERVICE  # Required for binding to ports 80/443
  
  # Ingress class
  ingressClassResource:
    name: nginx
    enabled: true
    default: true
  
  # Config options
  config:
    # Performance tuning
    worker-processes: "2"
    max-worker-connections: "16384"
    
    # Security headers
    hsts: "true"
    hsts-max-age: "31536000"
    hsts-include-subdomains: "true"
    
    # Compression
    use-gzip: "true"
    gzip-level: "5"
    
    # SSL/TLS
    ssl-protocols: "TLSv1.2 TLSv1.3"
    ssl-ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384"
    
    # Timeouts
    proxy-connect-timeout: "10"
    proxy-send-timeout: "60"
    proxy-read-timeout: "60"
    
    # Rate limiting
    limit-req-status-code: "429"
  
  # Admission webhooks
  admissionWebhooks:
    enabled: true
    
  # Service account
  serviceAccount:
    create: true
    name: ingress-nginx-controller

# Default backend (optional 404 page)
defaultBackend:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 10m
      memory: 20Mi
    limits:
      cpu: 50m
      memory: 64Mi

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1
